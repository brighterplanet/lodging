<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>impact_model.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1667526-20']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <style type="text/css">
    td.docs h1 {
      margin-top: 0;
    }
    @media print {
      .code pre {
        white-space: pre-wrap;
      }
      .code {
        padding-left: 0 !important;
        padding-right: 0 !important;
      }
      .code .highlight {
        margin-left: 15px;
        margin-right: 15px;
      }
    }
  </style>
</head>

<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>impact_model.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>Copyright Â© 2010 Brighter Planet.
See LICENSE for details.
Contact Brighter Planet for dual-license arrangements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Lodging_impact_model'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Lodging_impact_model">&#182;</a>
        </div>
        <h1>Lodging impact model</h1>

<p>This model is used by the <a href="http://brighterplanet.com">Brighter Planet</a> <a href="http://carbon.brighterplanet.com">CM1 web service</a> to calculate the impacts of a lodging (e.g. a hotel stay), such as energy use, greenhouse gas emissions, and water use.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Timeframe">&#182;</a>
        </div>
        <h4>Timeframe</h4>

<p>The model calculates impacts that occured during a particular time period (<code>timeframe</code>).
For example if the <code>timeframe</code> is February 2010, a lodging that occurred (<code>date</code>) on February 15, 2010 will have impacts, but a lodging that occurred on January 31, 2010 will have zero impacts.</p>

<p>The default <code>timeframe</code> is the current calendar year.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Calculations'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Calculations">&#182;</a>
        </div>
        <h4>Calculations</h4>

<p>The final impacts are the result of the calculations below. These are performed in reverse order, starting with the last calculation listed and finishing with the greenhouse gas emissions calculation.</p>

<p>Each calculation listing shows:</p>

<ul>
<li>value returned (<em>units of measurement</em>)</li>
<li>description of the value</li>
<li>calculation methods, listed from most to least preferred</li>
</ul>


<p>Some methods use <code>values</code> returned by prior calculations. If any of these <code>values</code> are unknown the method is skipped.
If all the methods for a calculation are skipped, the value the calculation would return is unknown.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Standard_compliance'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Standard_compliance">&#182;</a>
        </div>
        <h4>Standard compliance</h4>

<p>When compliance with a particular standard is requested, all methods that do not comply with that standard are ignored.
Thus any <code>values</code> a method needs will have been calculated using a compliant method or will be unknown.
To see which standards a method complies with, look at the <code>:complies =&gt;</code> section of the code in the right column.</p>

<p>Client input complies with all standards.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Collaboration'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Collaboration">&#182;</a>
        </div>
        <h4>Collaboration</h4>

<p>Contributions to this impact model are actively encouraged and warmly welcomed. This library includes a comprehensive test suite to ensure that your changes do not cause regressions. All changes should include test coverage for new functionality. Please see <a href="https://github.com/brighterplanet/sniff#readme">sniff</a>, our emitter testing framework, for more information.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">module</span> <span class="nn">BrighterPlanet</span>
  <span class="k">module</span> <span class="nn">Lodging</span>
    <span class="k">module</span> <span class="nn">ImpactModel</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">decide</span> <span class="ss">:impact</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="ss">:characteristics</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <hr />
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Carbon_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Carbon_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Carbon (<em>kg CO<sub>2</sub>e</em>)</h3>

<p><em>The lodging&rsquo;s total anthropogenic greenhouse gas emissions during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:carbon</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Multiply <code>natural gas use</code> (<em>m<sup>3</sup></em>) by its emission factor (<em>kg CO<sub>2</sub> / m<sup>3</sup></em>),
multiply <code>fuel oil use</code> (<em>l</em>) by its emission factor (<em>kg CO<sub>2</sub> / l</em>),
multiply <code>electricity use</code> (<em>kWh</em>) by <code>electricity emission factor</code> (<em>kg CO<sub>2</sub>e / kWh</em>),
and sum to give *kg CO<sub>2</sub>e.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from natural gas use, fuel oil use, electricity use, and electricity emission factor&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:natural_gas_use</span><span class="p">,</span> <span class="ss">:fuel_oil_use</span><span class="p">,</span> <span class="ss">:electricity_use</span><span class="p">,</span> <span class="ss">:electricity_emission_factor</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:natural_gas_use</span><span class="o">]</span> <span class="o">*</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s1">&#39;Pipeline Natural Gas&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_oil_use</span><span class="o">]</span> <span class="o">*</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s1">&#39;Distillate Fuel Oil No. 2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">co2_emission_factor</span> <span class="o">+</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_emission_factor</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_emission_factor_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e_/_kWh&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_emission_factor_(&lt;em&gt;kg_CO&lt;sub&gt;2&lt;/sub&gt;e_/_kWh&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Electricity emission factor (<em>kg CO<sub>2</sub>e / kWh</em>)</h3>

<p><em>A greenhouse gas emission factor for electricity used by the lodging.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:electricity_emission_factor</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Multiply the <code>eGRID subregion</code> electricity emission factors by 1 minus the the subregion&rsquo;s eGRID region loss factor (to account for transmission and distribution losses) to give <em>kg CO<sub>2</sub>e / kWh</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from eGRID subregion&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:egrid_subregion</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:egrid_subregion</span><span class="o">].</span><span class="n">electricity_emission_factor</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:egrid_subregion</span><span class="o">].</span><span class="n">egrid_region</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">)</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Otherwise look up the <code>country</code> electricity emission factor (<em>kg CO<sub>2</sub>e / kWh</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from country&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:country</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country</span><span class="o">].</span><span class="n">electricity_emission_factor</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Otherwise use a global average electricity emission factor (<em>kg CO<sub>2</sub>e / kWh</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span>
                <span class="no">Country</span><span class="o">.</span><span class="n">fallback</span><span class="o">.</span><span class="n">electricity_emission_factor</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Natural_gas_use_(&lt;em&gt;m&lt;sup&gt;3&lt;/sup&gt;&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Natural_gas_use_(&lt;em&gt;m&lt;sup&gt;3&lt;/sup&gt;&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Natural gas use (<em>m<sup>3</sup></em>)</h3>

<p><em>The lodging&rsquo;s natural gas use during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:natural_gas_use</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Use <code>fuels use equation</code> to calculate total fuels intensity (<em>MJ / room-night</em>).
Multiply total fuels intensity (<em>MJ / room-night</em>) by the natural gas share to give direct natural gas intensity (<em>MJ / room-night</em>).
Multiply total fuels intensity (<em>MJ / room-night</em>) by the steam share to give steam intensity (<em>MJ / room-night</em>). Assume half of this was generated by natural gas boilers with 81.7% efficiency and that transmission losses are 5% to give indirect natural gas intensity (<em>MJ / room-night</em>).
Sum direct and indirect natural gas intensity (<em>MJ / room-night</em>) and divide by natural gas energy content (<em>MJ / m<sup>3</sup></em>) to give natural gas intensity (<em>m<sup>3</sup> / room-night</em>).
Multiply natural gas intensity (<em>m<sup>3</sup> / room-night</em>) by <code>room nights</code> (<em>room-nights</em>) and divide by average hotel occupancy rate to give <em>m<sup>3</sup></em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuels use equation, room nights, and inputs&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="p">,</span> <span class="ss">:room_nights</span><span class="o">]</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:property_rooms</span><span class="p">,</span> <span class="ss">:property_construction_year</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">fuels_intensity</span> <span class="o">=</span> <span class="k">if</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">present?</span> <span class="ow">and</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">rooms_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">year_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">rooms_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">year_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span>
                <span class="k">end</span>
                <span class="n">direct_gas_energy_intensity</span> <span class="o">=</span> <span class="n">fuels_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">gas_share</span>
                <span class="n">indirect_gas_energy_intensity</span> <span class="o">=</span> <span class="p">(</span><span class="n">fuels_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">steam_share</span> <span class="o">/</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">817</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">95</span><span class="p">)</span>
                <span class="n">gas_intensity</span> <span class="o">=</span> <span class="p">(</span><span class="n">direct_gas_energy_intensity</span> <span class="o">+</span> <span class="n">indirect_gas_energy_intensity</span><span class="p">)</span> <span class="o">/</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Pipeline Natural Gas&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">energy_content</span>
                <span class="n">gas_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">59</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Otherwise multiply <code>room nights</code> (<em>room-nights</em>) by <code>natural gas intensity</code> (<em>m<sup>3</sup> / room-night</em>) to give direct natural gas use (<em>m<sup>3</sup></em>).
Multiply <code>room nights</code> (<em>room-nights</em>) by <code>steam intensity</code> (<em>MJ / room-night</em>) to give steam use (<em>MJ</em>). Assume half of this was generated by natural gas boilers with 81.7% efficiency and that transmission losses are 5%; divide by natural gas energy content (<em>MJ / m<sup>3</sup></em>) to give indirect natural gas use (<em>m<sup>3</sup></em>).
Sum direct and indirect natural gas use to give <em>m<sup>3</sup></em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuel intensities and room nights&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:fuel_intensities</span><span class="p">,</span> <span class="ss">:room_nights</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">direct_gas_use</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_intensities</span><span class="o">][</span><span class="ss">:natural_gas</span><span class="o">]</span>
                <span class="n">indirect_gas_use</span> <span class="o">=</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_intensities</span><span class="o">][</span><span class="ss">:steam</span><span class="o">]</span> <span class="o">/</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">817</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">95</span><span class="p">)</span> <span class="o">/</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Pipeline Natural Gas&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">energy_content</span>
                <span class="n">direct_gas_use</span> <span class="o">+</span> <span class="n">indirect_gas_use</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Fuel_oil_use_(&lt;em&gt;l&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Fuel_oil_use_(&lt;em&gt;l&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Fuel oil use (<em>l</em>)</h3>

<p><em>The lodging&rsquo;s fuel oil use during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:fuel_oil_use</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Use <code>fuels use equation</code> to calculate total fuels intensity (<em>MJ / room-night</em>).
Multiply total fuels intensity (<em>MJ / room-night</em>) by the fuel oil share to give direct fuel oil intensity (<em>MJ / room-night</em>).
Multiply total fuels intensity (<em>MJ</em>) by the steam share to give steam intensity (<em>MJ / room-night</em>). Assume half of this was generated by fuel oil boilers with 84.6% efficiency and that transmission losses are 5% to give indirect fuel oil intensity (<em>MJ / room-night</em>).
Sum direct and indirect fuel oil intensity (<em>MJ / room-night</em>) and divide by fuel oil energy content (<em>MJ / l</em>) to give fuel oil intensity (<em>l / room-night</em>).
Multiply fuel oil intensity (<em>l / room-night</em>) by <code>room-nights</code> (<em>room-nights</em>) and divide by average hotel occupancy rate to give <em>l</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuels use equation, room nights, and inputs&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="p">,</span> <span class="ss">:room_nights</span><span class="o">]</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:property_rooms</span><span class="p">,</span> <span class="ss">:property_construction_year</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">fuels_intensity</span> <span class="o">=</span> <span class="k">if</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">present?</span> <span class="ow">and</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">rooms_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">year_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">rooms_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">+</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">year_factor</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">constant</span>
                <span class="k">end</span>
                <span class="n">direct_oil_energy_intensity</span> <span class="o">=</span> <span class="n">fuels_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">oil_share</span>
                <span class="n">indirect_oil_energy_intensity</span> <span class="o">=</span> <span class="p">(</span><span class="n">fuels_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuels_use_equation</span><span class="o">].</span><span class="n">steam_share</span> <span class="o">/</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">846</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">95</span><span class="p">)</span>
                <span class="n">oil_intensity</span> <span class="o">=</span> <span class="p">(</span><span class="n">direct_oil_energy_intensity</span> <span class="o">+</span> <span class="n">indirect_oil_energy_intensity</span><span class="p">)</span> <span class="o">/</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Distillate Fuel Oil No. 2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">energy_content</span>
                <span class="n">oil_intensity</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">59</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Otherwise multiply <code>room nights</code> (<em>room-nights</em>) by <code>fuel oil intensity</code> (<em>l / room-night</em>) to give direct fuel oil use (<em>l</em>).
Multiply <code>room nights</code> (<em>room-nights</em>) by <code>steam intensity</code> (<em>MJ / room-night</em>) to give steam use (<em>MJ</em>). Assume half of this was generated by fuel oil boilers with 84.6% efficiency and that transmission losses are 5%; divide by fuel oil energy content (<em>MJ / l</em>) to give indirect fuel oil use (<em>l</em>).
Sum direct and indirect fuel oil use to give <em>l</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuel intensities and room nights&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:fuel_intensities</span><span class="p">,</span> <span class="ss">:room_nights</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">direct_oil_use</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_intensities</span><span class="o">][</span><span class="ss">:fuel_oil</span><span class="o">]</span>
                <span class="n">indirect_oil_use</span> <span class="o">=</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_intensities</span><span class="o">][</span><span class="ss">:steam</span><span class="o">]</span> <span class="o">/</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">846</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">95</span><span class="p">)</span> <span class="o">/</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Distillate Fuel Oil No. 2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">energy_content</span>
                <span class="n">direct_oil_use</span> <span class="o">+</span> <span class="n">indirect_oil_use</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_use_(&lt;em&gt;kWh&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_use_(&lt;em&gt;kWh&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Electricity use (<em>kWh</em>)</h3>

<p><em>The lodging&rsquo;s electricity use during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:electricity_use</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>Use <code>electricity use equation</code> to calculate electricity intensity (<em>MJ / room-night</em>).
Convert electricity intensity (<em>MJ / room-night</em>) to <em>kWh / room-night</em>, multiply by <code>room nights</code> (<em>room-nights</em>) and divide by average hotel occupancy to give <em>kWh</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from electricity use equation, room nights, and inputs&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="p">,</span> <span class="ss">:room_nights</span><span class="o">]</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:property_rooms</span><span class="p">,</span> <span class="ss">:property_construction_year</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">electricity_intensity</span> <span class="o">=</span> <span class="k">if</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">present?</span> <span class="ow">and</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">*</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">rooms_factor</span> <span class="o">**</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">year_factor</span> <span class="o">**</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">*</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">rooms_factor</span> <span class="o">**</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_rooms</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">present?</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">constant</span> <span class="o">*</span> <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">year_factor</span> <span class="o">**</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:property_construction_year</span><span class="o">].</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span>
                  <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_use_equation</span><span class="o">].</span><span class="n">constant</span>
                <span class="k">end</span>
                <span class="n">electricity_intensity</span><span class="o">.</span><span class="n">megajoules</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="ss">:kilowatt_hours</span><span class="p">)</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">/</span> <span class="mi">0</span><span class="o">.</span><span class="mi">59</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>Otherwise multiply <code>room nights</code> (<em>room-nights</em>) by <code>electricity intensity</code> (<em>kWh / room-night</em>) to give <em>kWh</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from fuel intensities and room nights&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:fuel_intensities</span><span class="p">,</span> <span class="ss">:room_nights</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:room_nights</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:fuel_intensities</span><span class="o">][</span><span class="ss">:electricity</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Fuels_use_equation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Fuels_use_equation">&#182;</a>
        </div>
        <h3>Fuels use equation</h3>

<p><em>An <a href="http://data.brighterplanet.com/lodging_fuel_use_equations">equation</a> derived from CBECS that predicts fuels use based on a lodging property&rsquo;s location and physical characteristics.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:fuels_use_equation</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Look up the appropriate equation for the available inputs.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from available characteristics&#39;</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:climate_zone_number</span><span class="p">,</span> <span class="ss">:property_rooms</span><span class="p">,</span> <span class="ss">:property_construction_year</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">LodgingFuelUseEquation</span><span class="o">.</span><span class="n">find_by_criteria</span><span class="p">(</span><span class="s1">&#39;Fuels&#39;</span><span class="p">,</span> <span class="n">characteristics</span><span class="p">)</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_use_equation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_use_equation">&#182;</a>
        </div>
        <h3>Electricity use equation</h3>

<p><em>An <a href="http://data.brighterplanet.com/lodging_fuel_use_equations">equation</a> derived from CBECS that predicts electricity use based on a lodging property&rsquo;s location and physical characteristics.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:electricity_use_equation</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>Look up the appropriate equation for the available inputs.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from available characteristics&#39;</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:climate_zone_number</span><span class="p">,</span> <span class="ss">:property_rooms</span><span class="p">,</span> <span class="ss">:property_construction_year</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">LodgingFuelUseEquation</span><span class="o">.</span><span class="n">find_by_criteria</span><span class="p">(</span><span class="s1">&#39;Electricity&#39;</span><span class="p">,</span> <span class="n">characteristics</span><span class="p">)</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Fuel_intensities_(&lt;em&gt;various&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Fuel_intensities_(&lt;em&gt;various&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Fuel intensities (<em>various</em>)</h3>

<p><em>The lodging&rsquo;s use per occupied room night of a variety of fuels.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:fuel_intensities</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>For each record in the <code>cohort</code>, multiply months used (<em>months</em>) by 365 (<em>days / year</em>) and divide by 7 (<em>days / week</em>) and by 12 (<em>months / year</em>) to give <em>weeks</em> the surveyed building was used.
Multiply by weekly hours (<em>hours / week</em>) and divide by 24 (<em>hours / day</em>) to give <em>days</em> the surveyed building was used.
Multiply by the number of rooms in the lodging property and 0.59 (average occupancy after PriceWaterhouseCoopers) to give <em>occupied room nights</em>.
Divide total use of each fuel by <em>occupied room nights</em> to give <em>fuel / room-night</em>.
Calculate the weighted average of each intensity across all records in the <code>cohort</code> to give:</p>

<ul>
<li>Natural gas intensity: <em>m<sup>3</sup> / room-night</em></li>
<li>Fuel oil intensity: <em>l / room-night</em></li>
<li>Electricity intensity: <em>kWh / room-night</em></li>
<li>Steam heat intensity: <em>MJ / room-night</em></li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from cohort&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:lodging_properties_cohort</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">intensities</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="o">[</span><span class="ss">:natural_gas</span><span class="p">,</span> <span class="ss">:fuel_oil</span><span class="p">,</span> <span class="ss">:electricity</span><span class="p">,</span> <span class="ss">:steam</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">fuel</span><span class="o">|</span>
                  <span class="n">intensities</span><span class="o">[</span><span class="n">fuel</span><span class="o">]</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_properties_cohort</span><span class="o">].</span><span class="n">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">sum</span><span class="p">,</span> <span class="n">record</span><span class="o">|</span>
                    <span class="k">next</span> <span class="n">sum</span> <span class="k">unless</span> <span class="n">record</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">fuel</span><span class="si">}</span><span class="s2">_use&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">present?</span>
                    <span class="n">occupied_room_nights</span> <span class="o">=</span> <span class="mi">365</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">7</span><span class="o">.</span><span class="mi">0</span> <span class="o">/</span> <span class="mi">12</span><span class="o">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">months_used</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">weekly_hours</span> <span class="o">/</span> <span class="mi">24</span><span class="o">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">lodging_rooms</span> <span class="o">*</span> <span class="mi">0</span><span class="o">.</span><span class="mi">59</span>
                    <span class="n">sum</span> <span class="o">+</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">weighting</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">fuel</span><span class="si">}</span><span class="s2">_use&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">occupied_room_nights</span><span class="p">)</span>
                  <span class="k">end</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_properties_cohort</span><span class="o">].</span><span class="n">sum</span><span class="p">(</span><span class="ss">:weighting</span><span class="p">)</span>
                <span class="k">end</span>
                <span class="n">intensities</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Otherwise look up the <code>country lodging class</code> fuel intensities:</p>

<ul>
<li>Natural gas intensity: <em>m<sup>3</sup> / room-night</em></li>
<li>Fuel oil intensity: <em>l / room-night</em></li>
<li>Electricity intensity: <em>kWh / room-night</em></li>
<li>Steam heat intensity: <em>MJ / room-night</em></li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from country lodging class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:country_lodging_class</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="p">{</span>
                  <span class="ss">:natural_gas</span>   <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country_lodging_class</span><span class="o">].</span><span class="n">natural_gas_intensity</span><span class="p">,</span>
                  <span class="ss">:fuel_oil</span>      <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country_lodging_class</span><span class="o">].</span><span class="n">fuel_oil_intensity</span><span class="p">,</span>
                  <span class="ss">:electricity</span>   <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country_lodging_class</span><span class="o">].</span><span class="n">electricity_intensity</span><span class="p">,</span>
                  <span class="ss">:steam</span>         <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country_lodging_class</span><span class="o">].</span><span class="n">steam_intensity</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>Otherwise check whether <code>country</code> has lodging fuel intensities:</p>

<ul>
<li>Natural gas intensity: <em>m<sup>3</sup> / room-night</em></li>
<li>Fuel oil intensity: <em>l / room-night</em></li>
<li>Electricity intensity: <em>kWh / room-night</em></li>
<li>Steam intensity: <em>MJ / room-night</em></li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from country&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:country</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">intensities</span> <span class="o">=</span> <span class="p">{</span>
                  <span class="ss">:natural_gas</span>   <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country</span><span class="o">].</span><span class="n">lodging_natural_gas_intensity</span><span class="p">,</span>
                  <span class="ss">:fuel_oil</span>      <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country</span><span class="o">].</span><span class="n">lodging_fuel_oil_intensity</span><span class="p">,</span>
                  <span class="ss">:electricity</span>   <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country</span><span class="o">].</span><span class="n">lodging_electricity_intensity</span><span class="p">,</span>
                  <span class="ss">:steam</span>         <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country</span><span class="o">].</span><span class="n">lodging_steam_intensity</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">intensities</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">compact</span><span class="o">.</span><span class="n">empty?</span> <span class="p">?</span> <span class="kp">nil</span> <span class="p">:</span> <span class="n">intensities</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Otherwise look up global average lodging fuel intensities:</p>

<ul>
<li>Natural gas intensity: <em>m<sup>3</sup> / room-night</em></li>
<li>Fuel oil intensity: <em>l / room-night</em></li>
<li>Electricity intensity: <em>kWh / room-night</em></li>
<li>Steam intensity: <em>MJ / room-night</em></li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span>
                <span class="p">{</span>
                  <span class="ss">:natural_gas</span>   <span class="o">=&gt;</span> <span class="no">Country</span><span class="o">.</span><span class="n">fallback</span><span class="o">.</span><span class="n">lodging_natural_gas_intensity</span><span class="p">,</span>
                  <span class="ss">:fuel_oil</span>      <span class="o">=&gt;</span> <span class="no">Country</span><span class="o">.</span><span class="n">fallback</span><span class="o">.</span><span class="n">lodging_fuel_oil_intensity</span><span class="p">,</span>
                  <span class="ss">:electricity</span>   <span class="o">=&gt;</span> <span class="no">Country</span><span class="o">.</span><span class="n">fallback</span><span class="o">.</span><span class="n">lodging_electricity_intensity</span><span class="p">,</span>
                  <span class="ss">:steam</span>         <span class="o">=&gt;</span> <span class="no">Country</span><span class="o">.</span><span class="n">fallback</span><span class="o">.</span><span class="n">lodging_steam_intensity</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Cohort'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Cohort">&#182;</a>
        </div>
        <h3>Cohort</h3>

<p><em>A set of responses from the <a href="http://data.brighterplanet.com/commercial_building_energy_consumption_survey_responses">EIA Commercial Buildings Energy Consumption Survey</a> that represent buildings similar to the lodging property.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:lodging_properties_cohort</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>If we know <code>census division</code>, assemble a cohort of CBECS responses:
Start with all responses, and then select only the responses that match <code>census region</code>, <code>country lodging class</code>, and <code>census division</code>.
If fewer than 8 responses match all of those characteristics, drop the last characteristic (initially <code>census division</code>) and try again.
Continue until we have 8 or more responses or we&rsquo;ve dropped all the characteristics.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from census division and input&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:census_division</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="ss">:country_lodging_class</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">provided_characteristics</span> <span class="o">=</span> <span class="o">[[</span><span class="ss">:census_region_number</span><span class="p">,</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:census_division</span><span class="o">].</span><span class="n">census_region_number</span><span class="o">]]</span>
                <span class="n">provided_characteristics</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="ss">:detailed_activity</span><span class="p">,</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country_lodging_class</span><span class="o">].</span><span class="n">cbecs_detailed_activity</span><span class="o">]</span> <span class="k">if</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:country_lodging_class</span><span class="o">].</span><span class="n">present?</span>
                <span class="n">provided_characteristics</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="ss">:census_division_number</span><span class="p">,</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:census_division</span><span class="o">].</span><span class="n">number</span><span class="o">]</span>
                
                <span class="n">cohort</span> <span class="o">=</span> <span class="no">CommercialBuildingEnergyConsumptionSurveyResponse</span><span class="o">.</span><span class="n">lodging_records</span><span class="o">.</span><span class="n">strict_cohort</span><span class="p">(</span><span class="o">*</span><span class="n">provided_characteristics</span><span class="p">)</span>
                <span class="n">cohort</span><span class="o">.</span><span class="n">any?</span> <span class="p">?</span> <span class="n">cohort</span> <span class="p">:</span> <span class="kp">nil</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Property_construction_year'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Property_construction_year">&#182;</a>
        </div>
        <h3>Property construction year</h3>

<p><em>The year the lodging property was built.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:property_construction_year</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>Otherwise look up the <code>lodging property</code> construction year.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from lodging property&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:lodging_property</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_property</span><span class="o">].</span><span class="n">construction_year</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Property_rooms'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Property_rooms">&#182;</a>
        </div>
        <h3>Property rooms</h3>

<p><em>The number of guest rooms in the lodging property.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:property_rooms</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-38'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-38">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p>Otherwise look up the <code>lodging property</code> number of rooms.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from lodging property&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:lodging_property</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_property</span><span class="o">].</span><span class="n">lodging_rooms</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Country_lodging_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Country_lodging_class">&#182;</a>
        </div>
        <h3>Country lodging class</h3>

<p><em>The lodging&rsquo;s <a href="http://data.brighterplanet.com/country_lodging_classes">country-specific lodging class</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:country_lodging_class</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-41'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-41">&#182;</a>
        </div>
        <p>Check whether the combination of <code>country</code> and <code>lodging class</code> matches a record in our database.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from country and lodging class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:country</span><span class="p">,</span> <span class="ss">:lodging_class</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">CountryLodgingClass</span><span class="o">.</span><span class="n">find_by_country_iso_3166_code_and_lodging_class_name</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:country</span><span class="o">].</span><span class="n">iso_3166_code</span><span class="p">,</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_class</span><span class="o">].</span><span class="n">name</span><span class="p">)</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Lodging_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Lodging_class">&#182;</a>
        </div>
        <h3>Lodging class</h3>

<p><em>The <a href="http://data.brighterplanet.com/lodging_classes">lodging&rsquo;s class</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:lodging_class</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-43'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-43">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-44'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-44">&#182;</a>
        </div>
        <p>Otherwise look up the <code>lodging property</code> lodging class.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from lodging property&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:lodging_property</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_property</span><span class="o">].</span><span class="n">lodging_class</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Lodging_property'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Lodging_property">&#182;</a>
        </div>
        <h3>Lodging property</h3>

<p><em>The property where the stay occurred.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:lodging_property</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-46'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-46">&#182;</a>
        </div>
        <p>Use a custom matching algorithm to look up a lodging property based on user inputs.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s2">&quot;from custom matching algorithm&quot;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:lodging_property_name</span><span class="p">,</span> <span class="ss">:appreciates</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:zip_code</span><span class="p">,</span> <span class="ss">:city</span><span class="p">,</span> <span class="ss">:state</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">LodgingProperty</span><span class="o">.</span><span class="n">better_match</span> <span class="n">characteristics</span> <span class="k">if</span> <span class="no">LodgingProperty</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:better_match</span><span class="p">)</span>
            <span class="k">end</span>
<span class="cm">=begin</span>
<span class="cm">            CAREFUL! there isn&#39;t a test for the custom algorithm quorum</span>
<span class="cm">=end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-47'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-47">&#182;</a>
        </div>
        <p>Otherwise check whether <code>lodging property name</code> matches a property in <code>zip code</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s2">&quot;from lodging property name and zip code&quot;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:lodging_property_name</span><span class="p">,</span> <span class="ss">:zip_code</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">LodgingProperty</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:postcode</span> <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:zip_code</span><span class="o">].</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">find_by_name</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_property_name</span><span class="o">].</span><span class="n">value</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-48'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-48">&#182;</a>
        </div>
        <p>Otherwise check whether <code>lodging property name</code> matches a property in <code>city</code> and <code>state</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s2">&quot;from lodging property name, city, and state&quot;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:lodging_property_name</span><span class="p">,</span> <span class="ss">:city</span><span class="p">,</span> <span class="ss">:state</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">LodgingProperty</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:city</span> <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:city</span><span class="o">].</span><span class="n">value</span><span class="p">,</span> <span class="ss">:locality</span> <span class="o">=&gt;</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:state</span><span class="o">].</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">find_by_name</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:lodging_property_name</span><span class="o">].</span><span class="n">value</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Lodging_property_name'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Lodging_property_name">&#182;</a>
        </div>
        <h3>Lodging property name</h3>

<p><em>The name of the property where the stay occurred.</em></p>

<p>Use client input, if available</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Climate_zone_number'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Climate_zone_number">&#182;</a>
        </div>
        <h3>Climate zone number</h3>

<p><em>The lodging property&rsquo;s <a href="http://www.eia.gov/emeu/cbecs/climate_zones.html">climate zone number</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:climate_zone_number</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-51'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-51">&#182;</a>
        </div>
        <p>Look up the <code>climate division</code> climate zone number.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from climate division&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:climate_division</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:climate_division</span><span class="o">].</span><span class="n">climate_zone_number</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-52'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-52">&#182;</a>
        </div>
        <p>Look up the <code>state</code> climate zone number.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from state&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:state</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:state</span><span class="o">].</span><span class="n">climate_zone_number</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Climate_division'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Climate_division">&#182;</a>
        </div>
        <h3>Climate division</h3>

<p><em>The lodging property&rsquo;s <a href="http://data.brighterplanet.com/climate_divisions">climate division</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:climate_division</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-54'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-54">&#182;</a>
        </div>
        <p>Look up the <code>zip code</code> climate division.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from zip code&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:zip_code</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:zip_code</span><span class="o">].</span><span class="n">climate_division</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Census_division'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Census_division">&#182;</a>
        </div>
        <h3>Census division</h3>

<p><em>The lodging property&rsquo;s <a href="http://data.brighterplanet.com/census_divisions">census division</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:census_division</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-56'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-56">&#182;</a>
        </div>
        <p>Look up the <code>state</code> census division.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from state&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:state</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:state</span><span class="o">].</span><span class="n">census_division</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-eGRID_subregion'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-eGRID_subregion">&#182;</a>
        </div>
        <h3>eGRID subregion</h3>

<p><em>The lodging property&rsquo;s <a href="http://data.brighterplanet.com/egrid_subregions">eGRID subregion</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:egrid_subregion</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-58'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-58">&#182;</a>
        </div>
        <p>Look up the <code>zip code</code> eGRID subregion.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from zip code&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:zip_code</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:zip_code</span><span class="o">].</span><span class="n">egrid_subregion</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Country'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Country">&#182;</a>
        </div>
        <h3>Country</h3>

<p><em>The lodging property&rsquo;s <a href="http://data.brighterplanet.com/countries">country</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:country</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-60'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-60">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-61'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-61">&#182;</a>
        </div>
        <p>If state is defined then the country is the United States.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from state&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:state</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="no">Country</span><span class="o">.</span><span class="n">united_states</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-State'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-State">&#182;</a>
        </div>
        <h3>State</h3>

<p><em>The lodging property&rsquo;s <a href="http://data.brighterplanet.com/states">US state</a>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:state</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-63'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-63">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-64'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-64">&#182;</a>
        </div>
        <p>Otherwise look up the <code>zip code</code> state.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from zip code&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:zip_code</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:zip_code</span><span class="o">].</span><span class="n">state</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-City'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-City">&#182;</a>
        </div>
        <h3>City</h3>

<p><em>The lodging property&rsquo;s city.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:city</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-66'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-66">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-67'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-67">&#182;</a>
        </div>
        <p>Otherwise look up the <code>zip code</code> description.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from zip code&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:zip_code</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span>
                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:zip_code</span><span class="o">].</span><span class="n">description</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Zip_code'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Zip_code">&#182;</a>
        </div>
        <h3>Zip code</h3>

<p><em>The lodging property&rsquo;s <a href="http://data.brighterplanet.com/zip_codes">US zip code</a>.</em></p>

<p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Room_nights_(&lt;em&gt;room-nights&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Room_nights_(&lt;em&gt;room-nights&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Room nights (<em>room-nights</em>)</h3>

<p><em>The stay&rsquo;s room-nights that occurred during <code>timeframe</code>.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:room_nights</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-70'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-70">&#182;</a>
        </div>
        <p>If <code>date</code> falls within <code>timeframe</code>, divide <code>duration</code> (<em>seconds</em>) by 86,400 (<em>seconds / night</em>) and multiply by <code>rooms</code> to give <em>room-nights</em>.
Otherwise <code>room nights</code> is zero.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from rooms, duration, date, and timeframe&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:rooms</span><span class="p">,</span> <span class="ss">:duration</span><span class="p">,</span> <span class="ss">:date</span><span class="o">]</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span>
                <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="p">?</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:duration</span><span class="o">]</span> <span class="o">/</span> <span class="mi">86400</span><span class="o">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:rooms</span><span class="o">]</span> <span class="p">:</span> <span class="mi">0</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Duration_(&lt;em&gt;seconds&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Duration_(&lt;em&gt;seconds&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Duration (<em>seconds</em>)</h3>

<p><em>The stay&rsquo;s duration.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:duration</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-72'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-72">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-73'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-73">&#182;</a>
        </div>
        <p>Otherwise use 86400 <em>seconds</em> (1 night).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span> <span class="k">do</span>
              <span class="mi">86400</span><span class="o">.</span><span class="mi">0</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Rooms'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Rooms">&#182;</a>
        </div>
        <h3>Rooms</h3>

<p><em>The number of rooms used.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:rooms</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-75'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-75">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-76'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-76">&#182;</a>
        </div>
        <p>Otherwise use 1 <em>room</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span> <span class="k">do</span>
              <span class="mi">1</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Date_(&lt;em&gt;date&lt;/em&gt;)'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_(&lt;em&gt;date&lt;/em&gt;)">&#182;</a>
        </div>
        <h3>Date (<em>date</em>)</h3>

<p><em>The day the stay occurred.</em></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:date</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-78'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-78">&#182;</a>
        </div>
        <p>Use client input, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-79'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-79">&#182;</a>
        </div>
        <p>Otherwise use the first day of <code>timeframe</code>.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from timeframe&#39;</span><span class="p">,</span>
              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span>
                <span class="n">timeframe</span><span class="o">.</span><span class="n">from</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
